#!/bin/rc

builddir=`{pwd}
bind -b $builddir/src.9.boot /sys/src/9/boot
bind -b $builddir/src.9.port /sys/src/9/port
bind -b $builddir/src.9.pc /sys/src/9/pc
bind -b $builddir/scripts /bin
bind $builddir /n/rootless
bind -bc $builddir/compiletemp /sys/src/9/pc
if(~ $1 clean){
	cd /sys/src/9/pc
	mk clean
	exit
}
if(~ $1 rootfs){
	rm root/bin/*
	cp root/lib/_toolcopyscript root/bin
	cd root/bin
	. _toolcopyscript
	cd $builddir
	ramfs -m /tmp
	tar cf /tmp/rootfs.tar root
	gzip -9 -c /tmp/rootfs.tar >rootfs.tgz
	exit
}
cp scripts/* bootdir.extras/root/bin
cd bootdir.extras
tar cf skel.tar root
if(~ $1 ramfs){
	ramfs -m /tmp
	bind -bc /tmp /sys/src/9/pc
}
cd /sys/src/9/pc
mk 'CONF=pcram'
gzip -9 -c 9pcram > $builddir/compiletemp/9pcram.gz
