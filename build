#!/bin/rc

builddir=`{pwd}
bind -b $builddir/src.9.boot /sys/src/9/boot
bind -b $builddir/src.9.port /sys/src/9/port
bind -b $builddir/src.9.pc /sys/src/9/pc
bind $builddir /n/rootless
bind -bc $builddir/compiletemp /sys/src/9/pc
if(~ $1 clean){
	cd /sys/src/9/pc
	mk clean
	exit
}
if(~ $1 rootfs){
	ramfs -m /tmp -S ramtmp
	tar cf /tmp/rootfs.tar root
	gzip -9 -c /tmp/rootfs.tar >rootfs.tgz
#	tar czf rootfs.tgz root
	exit
}
cp scripts/* root/bin
cd bootdir.extras
tar cf skel.tar root
if(~ $2 ramfs){
	ramfs -m /tmp -S ramtmp
	bind -bc /tmp /sys/src/9/pc
}
cd /sys/src/9/pc
mk 'CONF=pcram'
gzip -9 -c 9pcram > $builddir/compiletemp/9pcram.gz
